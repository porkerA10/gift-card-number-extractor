{
  "CreationDate": "2018-2-10",
  "Commands": [
    {
      "Command": "click",
      "Target": "/descendant::span[@autoid='_lvv_g' and text()[contains(.,'A Gift Card for you!')]][${!LOOP}]",
      "Value": ""
    },
    {
      "Command": "store",
      "Target": "0",
      "Value": "i"
    },
    {
      "Command": "storeEval",
      "Target": "document.evaluate(\"count(/descendant::a[contains(@href,'https://egift.activationspot.com/egift')])\", document).numberValue",
      "Value": "count"
    },
    {
      "Command": "echo",
      "Target": "Found ${count} codes to loop over",
      "Value": ""
    },
    {
      "Command": "while",
      "Target": "(${i} < ${count})",
      "Value": ""
    },
    {
      "Command": "storeEval",
      "Target": "${i} + 1",
      "Value": "i"
    },
    {
      "Command": "click",
      "Target": "/descendant::a[contains(@href,'https://egift.activationspot.com/egift')][${i}]",
      "Value": ""
    },
    {
      "Command": "waitForPageToLoad",
      "Target": "",
      "Value": ""
    },
    {
      "Command": "selectWindow",
      "Target": "TAB=1",
      "Value": ""
    },
    {
      "Command": "if",
      "Target": "document.evaluate(\"count(/descendant::h1[@class='off-page'])\", document).numberValue === 1",
      "Value": ""
    },
    {
      "Command": "storeText",
      "Target": "/descendant::h1[@class='off-page']",
      "Value": "brandTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${brandTemp}\"; s.replace('Your ','').replace(/(\\$[\\d]+)? eGift card/i,'').trim();",
      "Value": "brand"
    },
    {
      "Command": "storeText",
      "Target": "id=amount",
      "Value": "amountTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${amountTemp}\"; Number.parseFloat(/.*[$](\\d+)/.exec(s)[1]);",
      "Value": "amount"
    },
    {
      "Command": "storeText",
      "Target": "id=cardNumber2",
      "Value": "cardNumberTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${cardNumberTemp}\"; s.replace(/ /g,'');",
      "Value": "cardNumber"
    },
    {
      "Command": "storeText",
      "Target": "id=pin",
      "Value": "pinTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${pinTemp}\"; /.*?(\\d+)/.exec(s)[1];",
      "Value": "pin"
    },
    {
      "Command": "else",
      "Target": "",
      "Value": ""
    },
    {
      "Command": "storeText",
      "Target": "/descendant::div[@id='main']/h1",
      "Value": "brandTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${brandTemp}\"; s.replace('Your ','').replace(/(\\$[\\d]+)? eGift card/i,'').trim();",
      "Value": "brand"
    },
    {
      "Command": "storeText",
      "Target": "/descendant::div[@class='showCardInfo']/h2",
      "Value": "amountTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${amountTemp}\"; Number.parseFloat(/.*[$](\\d+)/.exec(s)[1]);",
      "Value": "amount"
    },
    {
      "Command": "storeText",
      "Target": "id=cardNumber2",
      "Value": "cardNumberTemp"
    },
    {
      "Command": "storeEval",
      "Target": "var s=\"${cardNumberTemp}\"; s.replace(/ /g,'');",
      "Value": "cardNumber"
    },
    {
      "Command": "storeText",
      "Target": "/descendant::div[@class='cardNum']/p[2]/span",
      "Value": "pin"
    },
    {
      "Command": "endif",
      "Target": "",
      "Value": ""
    },
    {
      "Command": "echo",
      "Target": "Found ${amountTemp} and ${amount} ${cardNumber} unkay orig ${cardNumberTemp} pin is ${pin}",
      "Value": ""
    },
    {
      "Command": "store",
      "Target": "${brand}",
      "Value": "!csvLine"
    },
    {
      "Command": "store",
      "Target": "${amount}",
      "Value": "!csvLine"
    },
    {
      "Command": "store",
      "Target": "${cardNumber}",
      "Value": "!csvLine"
    },
    {
      "Command": "store",
      "Target": "${pin}",
      "Value": "!csvLine"
    },
    {
      "Command": "store",
      "Target": "",
      "Value": "!csvLine"
    },
    {
      "Command": "store",
      "Target": "",
      "Value": "!csvLine"
    },
    {
      "Command": "store",
      "Target": "${!URL}",
      "Value": "!csvLine"
    },
    {
      "Command": "csvSave",
      "Target": "SPay",
      "Value": ""
    },
    {
      "Command": "storeEval",
      "Target": "new Date().toISOString().replace(/[^0-9]/g, \"\")",
      "Value": "timestamp"
    },
    {
      "Command": "captureScreenshot",
      "Target": "${timestamp}-PPDG.png",
      "Value": ""
    },
    {
      "Command": "selectWindow",
      "Target": "TAB=0",
      "Value": ""
    },
    {
      "Command": "selectWindow",
      "Target": "TAB=CLOSEALLOTHER",
      "Value": ""
    },
    {
      "Command": "endWhile",
      "Target": "",
      "Value": ""
    }
  ]
}
